const SANDRA_API_URL=window.SANDRA_API_URL||'https://api.sandra.local';const SANDRA_API_KEY=window.SANDRA_API_KEY||'REPLACE_ME';const AVATAR_IFRAME_URL=window.AVATAR_IFRAME_URL||'about:blank';const SandraUI={show:t=>{document.getElementById('panel-text').style.display=t==='text'?'block':'none';document.getElementById('panel-voice').style.display=t==='voice'?'block':'none';document.getElementById('panel-avatar').style.display=t==='avatar'?'block':'none'},log:(r,t)=>{const e=document.getElementById('chat-log');const l=document.createElement('div');l.style.marginBottom='6px';l.innerHTML=`<strong>${r}:</strong> ${t}`;e.appendChild(l);e.scrollTop=e.scrollHeight},setVoiceStatus:t=>{document.getElementById('voice-status').textContent=t||''}};const SandraAPI={async sendText(){const e=document.getElementById('chat-input');const t=e.value.trim();if(!t)return;SandraUI.log('TÃº',t);e.value='';try{const s=await fetch(`${SANDRA_API_URL}/chat`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${SANDRA_API_KEY}`},body:JSON.stringify({message:t})});if(!s.ok)throw new Error('HTTP '+s.status);const a=await s.json();const r=a.reply||'(respuesta)';SandraUI.log('Sandra',r);this.playTTS(r)}catch(o){const d='Hola ðŸ‘‹ Soy Sandra en modo demo. Configura SANDRA_API_URL y API Key para conexiÃ³n real.';SandraUI.log('Sandra',d);this.playTTS(d)}},_media:{rec:null,chunks:[]},async startVoice(){SandraUI.setVoiceStatus('Preparando micrÃ³fono...');try{const e=await navigator.mediaDevices.getUserMedia({audio:true});const t=new MediaRecorder(e);this._media.rec=t;this._media.chunks=[];t.ondataavailable=s=>this._media.chunks.push(s.data);t.onstop=async()=>{const s=new Blob(this._media.chunks,{type:'audio/webm'});SandraUI.setVoiceStatus('Enviando audio...');try{const a=new FormData();a.append('audio',s,'input.webm');const r=await fetch(`${SANDRA_API_URL}/speech`,{method:'POST',headers:{'Authorization':`Bearer ${SANDRA_API_KEY}`},body:a});if(!r.ok)throw new Error('HTTP '+r.status);const o=await r.json();const d=o.text||'(texto)';const n=o.reply||'(respuesta voz)';SandraUI.log('TÃº (vozâ†’texto)',d);SandraUI.log('Sandra',n);this.playTTS(n);SandraUI.setVoiceStatus('Listo.')}catch(i){SandraUI.setVoiceStatus('Demo voz. Conecta backend para respuesta real.');this.playTTS('Modo demo de voz activado.')}};t.start();SandraUI.setVoiceStatus('Grabando... suelta para enviar.')}catch(c){SandraUI.setVoiceStatus('Permiso de micrÃ³fono denegado o error.')}},stopVoice(){const e=this._media.rec;if(e&&e.state!=='inactive'){e.stop();SandraUI.setVoiceStatus('Procesando audio...')}},playTTS:t=>{try{if(!('speechSynthesis'in window))return;const e=new SpeechSynthesisUtterance(t);e.lang='es-ES';speechSynthesis.cancel();speechSynthesis.speak(e)}catch{}},loadAvatar(){const e=document.getElementById('avatar-frame');e.src=AVATAR_IFRAME_URL},sendAvatarCommand:t=>{const e=document.getElementById('avatar-frame');if(!e.contentWindow)return;e.contentWindow.postMessage({type:'sandra-command',command:t},'*')}};window.SandraAPI=SandraAPI;window.SandraUI=SandraUI;